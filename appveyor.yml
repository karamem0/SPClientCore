version: "3.5.1.{build}"
skip_non_tags: true
image: Visual Studio 2019
configuration: Release
dotnet_csproj:
  patch: true
  file: '**\*.csproj'
  version: '{version}'
  package_version: '{version}'
  assembly_version: '{version}'
  file_version: '{version}'
  informational_version: '{version}'
environment:
  NUGET_API_KEY:
    secure: onXIsjs9rpQLczvPCCqZEd4jHxbXk0EaAJheCUhqzKbbJ3VchV8aB//a1KMD95Uv
build_script:
- ps: |
    Set-Location "$env:APPVEYOR_BUILD_FOLDER\source\$env:APPVEYOR_PROJECT_NAME"
    dotnet restore --source https://api.nuget.org/v3/index.json
    dotnet publish --configuration $env:CONFIGURATION
    Update-ModuleManifest -Path "$env:APPVEYOR_BUILD_FOLDER\source\$env:APPVEYOR_PROJECT_NAME\bin\$env:CONFIGURATION\netstandard2.0\publish\$env:APPVEYOR_PROJECT_NAME.psd1" -ModuleVersion "$env:APPVEYOR_BUILD_VERSION"
test: off
artifacts:
- path: source\$(APPVEYOR_PROJECT_NAME)\bin\$(CONFIGURATION)\netstandard2.0\publish
  name: SPClientCore_$(APPVEYOR_BUILD_VERSION)
deploy_script:
- ps: |
    Publish-Module -Name "$env:APPVEYOR_BUILD_FOLDER\source\$env:APPVEYOR_PROJECT_NAME\bin\$env:CONFIGURATION\netstandard2.0\publish\$env:APPVEYOR_PROJECT_NAME.psd1" -NuGetApiKey "$env:NUGET_API_KEY"
